# Architecture Diagrams & Flow Charts

## ğŸ—ï¸ Application Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PRESENTATION LAYER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Blazor Components (Interactive Server)               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ ChatCreateForm  â”‚  â”‚  ChatForm        â”‚  â”‚ ChatHome   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - Validates     â”‚  â”‚ - Displays msgs  â”‚  â”‚ - Lists    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - Creates DTOs  â”‚  â”‚ - Sends msgs     â”‚  â”‚   chats    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - Uses Hub      â”‚  â”‚ - Uses Hub       â”‚  â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                        â”‚                              â”‚
â”‚              â”‚ SignalR               â”‚ SignalR                       â”‚
â”‚              â”‚ WebSocket             â”‚ WebSocket                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SIGNALR HUBS (Real-time)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Hub: /chathub (ChatHub)           âœ… DONE         â”‚   â”‚
â”‚  â”‚  - AddChat(ChatDto, ChatInvitationDto[])                    â”‚   â”‚
â”‚  â”‚  - Broadcasts: ChatCreated                                  â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚            Hub: /invitationhub (Template)    ğŸ”œ TODO         â”‚   â”‚
â”‚  â”‚  - AcceptInvitation()                                       â”‚   â”‚
â”‚  â”‚  - RejectInvitation()                                       â”‚   â”‚
â”‚  â”‚  - GetPendingInvitations()                                  â”‚   â”‚
â”‚  â”‚  - Broadcasts: InvitationAccepted, etc.                     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚            Hub: /messagehub (Template)       ğŸ”œ TODO         â”‚   â”‚
â”‚  â”‚  - JoinChat(int, int)                                       â”‚   â”‚
â”‚  â”‚  - SendMessage(int, ChatMessageDto)                         â”‚   â”‚
â”‚  â”‚  - GetChatHistory(int)                                      â”‚   â”‚
â”‚  â”‚  - Broadcasts via groups: ReceiveMessage                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVICE LAYER (Business Logic)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           ChatService                     âœ… REFACTORED     â”‚   â”‚
â”‚  â”‚  - AddChatWithInvitations(ChatDto) â†’ ChatDto               â”‚   â”‚
â”‚  â”‚  - GetChatById(int) â†’ Chat?                                â”‚   â”‚
â”‚  â”‚  - GetChatsForUser(ChatUser) â†’ Chat[]                      â”‚   â”‚
â”‚  â”‚  - ConvertToDto(Chat) â†’ ChatDto                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚           InvitationsService              âœ… REFACTORED     â”‚   â”‚
â”‚  â”‚  - AddInvitations(ChatInvitationDto[])                     â”‚   â”‚
â”‚  â”‚  - AddInvitation(ChatInvitationDto)                        â”‚   â”‚
â”‚  â”‚  - ConvertToDto(ChatInvitation) â†’ ChatInvitationDto        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚           MessagesService                 âœ… REFACTORED     â”‚   â”‚
â”‚  â”‚  - AddChatMessage(ChatMessageDto) â†’ ChatMessageDto         â”‚   â”‚
â”‚  â”‚  - GetChatMessages(int) â†’ ChatMessageDto[]                 â”‚   â”‚
â”‚  â”‚  - ConvertToDto(ChatMessage) â†’ ChatMessageDto              â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚           ChatUserService                 âœ… UNCHANGED      â”‚   â”‚
â”‚  â”‚  - GetUser(int?) â†’ ChatUser?                               â”‚   â”‚
â”‚  â”‚  - GetUserByEmail(string) â†’ ChatUser?                      â”‚   â”‚
â”‚  â”‚  - GetUserByEmail(string[]) â†’ ChatUser[]?                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DATA ACCESS LAYER (EF Core)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ChatDbContext                  âœ… UNCHANGED    â”‚   â”‚
â”‚  â”‚  - DbSet<Chat>                                             â”‚   â”‚
â”‚  â”‚  - DbSet<ChatUser>                                         â”‚   â”‚
â”‚  â”‚  - DbSet<ChatMessage>                                      â”‚   â”‚
â”‚  â”‚  - DbSet<ChatInvitation>                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE (MySQL)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Chats  â”‚  ChatUsers  â”‚  ChatMessages  â”‚  ChatInvitations  â”‚   â”‚
â”‚  â”‚  (CRUD) â”‚   (CRUD)    â”‚    (CRUD)      â”‚    (CRUD)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¨ Chat Creation Flow (Sequence Diagram)

```
User                  Frontend            Hub              Service            Database
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚â”€â”€â”€ Fill Form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚â”€â”€â”€ Submit Form â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚                       â”‚â”€ Create DTO â”€â†’  â”‚                 â”‚                  â”‚
 â”‚                       â”‚ ChatDto          â”‚                 â”‚                  â”‚
 â”‚                       â”‚ Invitation[]     â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚â”€ AddChat() â”€â”€â”€â”€â†’â”‚                  â”‚
 â”‚                       â”‚                 â”‚  ChatDto        â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚â”€ Lookup Owner â”€â”€â†’â”‚
 â”‚                       â”‚                 â”‚                 â”‚â†â”€ ChatUser â”€â”€â”€â”€â”€â”€â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚â”€ Create Chat â”€â”€â”€â†’â”‚
 â”‚                       â”‚                 â”‚                 â”‚  (Entity)        â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚â†â”€ Chat (ID) â”€â”€â”€â”€â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚ AddInvitations()â”‚                  â”‚
 â”‚                       â”‚                 â”‚  Invitation[]   â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚â”€ Create Invi â”€â”€â†’â”‚
 â”‚                       â”‚                 â”‚                 â”‚  (Entities)     â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚ ChatDto â†â”€â”€â”€â”€â”€  â”‚                  â”‚
 â”‚                       â”‚                 â”‚ (with ID)       â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚                       â”‚ ChatCreated â†â”€â”€â”€â”‚                 â”‚                  â”‚
 â”‚                       â”‚ (Event)         â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
 â”‚ â† Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                 â”‚                  â”‚
 â”‚   + Chat ID           â”‚ Reset Form      â”‚                 â”‚                  â”‚
 â”‚                       â”‚                 â”‚                 â”‚                  â”‚
```

---

## ğŸ”„ DTO Transformation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETE DATA FLOW                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  INCOMING (Client â†’ Server)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚  ChatDto â”€â”€[Hub receives]â”€â”€â†’ Service Layer                 â”‚
â”‚                              â†“                              â”‚
â”‚                          DTO â†’ Entity                       â”‚
â”‚                          Mapping                            â”‚
â”‚                              â†“                              â”‚
â”‚                          Save to DB                         â”‚
â”‚                              â†“                              â”‚
â”‚                                                              â”‚
â”‚  OUTGOING (Server â†’ Client)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚  Entity (from DB) â”€â”€[Service retrieves]                    â”‚
â”‚                              â†“                              â”‚
â”‚                          Entity â†’ DTO                       â”‚
â”‚                          Mapping                            â”‚
â”‚                              â†“                              â”‚
â”‚                  â”€â”€[Hub broadcasts]â”€â”€â†’ ChatDto             â”‚
â”‚                                       (to clients)          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Data Model Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ChatUser      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Id (PK)         â”‚
â”‚ Email           â”‚
â”‚ UserName        â”‚
â”‚ ... (Identity)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â†’ 1:* â”€â”€â†’ Owns â†’ Chat (ChatOwnerId)
         â”‚
         â”œâ”€â†’ *:* â”€â”€â†’ Members of â†’ Chat (via ChatUsers list)
         â”‚
         â”œâ”€â†’ 1:* â”€â”€â†’ Sends â†’ ChatMessage (ChatUserId)
         â”‚
         â”œâ”€â†’ 1:* â”€â”€â†’ Sends â†’ ChatInvitation (SenderId)
         â”‚
         â””â”€â†’ 1:* â”€â”€â†’ Receives â†’ ChatInvitation (ReceiverId)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Chat       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Id (PK)         â”‚
â”‚ ChatName        â”‚
â”‚ ChatOwnerId (FK)â”‚
â”‚ ChatUsers (*)   â”‚
â”‚ Messages (*)    â”‚
â”‚ Invitations (*)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â†’ 1:* â”€â”€â†’ Contains â†’ ChatMessage (ChatId)
         â”‚
         â””â”€â†’ 1:* â”€â”€â†’ Invites â†’ ChatInvitation (ChatId)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ChatMessage        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Id (PK)              â”‚
â”‚ Content              â”‚
â”‚ MessageDateTime      â”‚
â”‚ ChatId (FK)          â”‚
â”‚ ChatUserId (FK)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChatInvitation      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SenderId (FK)        â”‚
â”‚ ReceiverId (FK)      â”‚
â”‚ ChatId (FK)          â”‚
â”‚ Accepted             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ DTO Structure Overview

```
INPUT DTOs (Client â†’ Server)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ChatDto (Create)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ChatName: string              â”‚
â”‚ - ChatOwnerId: int              â”‚
â”‚ - InvitedEmails: List<string>   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ChatInvitationDto (Create)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - SenderId: int                  â”‚
â”‚ - ReceiverId: int                â”‚
â”‚ - SenderEmail: string            â”‚
â”‚ - ReceiverEmail: string          â”‚
â”‚ - ChatId: int (0 initially)      â”‚
â”‚ - Accepted: bool (false)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChatMessageDto (Send)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ChatId: int                    â”‚
â”‚ - ChatUserId: int                â”‚
â”‚ - SenderEmail: string            â”‚
â”‚ - MessageContent: string         â”‚
â”‚ - MessageDateTime: DateTime      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


OUTPUT DTOs (Server â†’ Client)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ChatDto (Response)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + Id: int âœ¨ (populated by DB)   â”‚
â”‚ - ChatName: string               â”‚
â”‚ - ChatOwnerId: int               â”‚
â”‚ - ChatOwnerEmail: string         â”‚
â”‚ - InvitedEmails: List<string>    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatInvitationDto (Response)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - SenderId: int                   â”‚
â”‚ - SenderEmail: string             â”‚
â”‚ - ReceiverId: int                 â”‚
â”‚ - ReceiverEmail: string           â”‚
â”‚ + ChatId: int âœ¨ (populated)      â”‚
â”‚ - Accepted: bool                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatMessageDto (Response)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + Id: int âœ¨ (populated by DB)    â”‚
â”‚ - ChatId: int                     â”‚
â”‚ - ChatUserId: int                 â”‚
â”‚ - SenderEmail: string             â”‚
â”‚ - MessageContent: string          â”‚
â”‚ + MessageDateTime: DateTime âœ¨    â”‚
â”‚   (set by server)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ Request/Response Cycle

```
REQUEST CYCLE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Client prepares payload:
    DTO with user input values
         â†“
Client sends via hub:
    hubConnection.SendAsync("MethodName", dto1, dto2)
         â†“
Hub receives DTOs:
    public async Task MethodName(Dto1 dto1, Dto2 dto2)
         â†“
Hub transforms to entities:
    var entity1 = new Entity { ... from dto1 };
         â†“
Service processes entities:
    Save to database
    Transform result back to DTO
         â†“
Hub broadcasts DTO:
    await Clients.All.SendAsync("EventName", resultDto)


RESPONSE CYCLE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Server sends via hub:
    resultDto contains DB-generated values (IDs, timestamps)
         â†“
Clients receive event:
    hubConnection.on("EventName", (dto) => { ... })
         â†“
Client uses DTO properties:
    Update local state
    Refresh UI
    Store message ID, etc.
```

---

## ğŸš€ Message Queue Flow (Groups)

```
Chat Room: chat-42
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

User A â”€â”€â”
         â”œâ”€â†’ Group: chat-42
User B â”€â”€â”¤      
         â”œâ”€ Subscribers:
User C â”€â”€â”¤   â€¢ Connection-A1
         â””â”€  â€¢ Connection-B1
            â€¢ Connection-C1

Message Send Flow:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

User A sends message:
    hubConnection.SendAsync("SendMessage", chatId=42, messageDto)
         â†“
Hub receives in group chat-42:
    public async Task SendMessage(int chatId, ChatMessageDto msg)
         â†“
Hub broadcasts to group:
    await Clients.Group($"chat-{chatId}").SendAsync("ReceiveMessage", msg)
         â†“
All users in group receive:
    â€¢ User A's client (echo)
    â€¢ User B's client (new message)
    â€¢ User C's client (new message)
         â†“
Each client handles event:
    hubConnection.on("ReceiveMessage", (dto) => {
        messages.Add(dto);
        StateHasChanged();
    })
```

---

## âœ… Ready State Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ARCHITECTURE REFACTOR STATUS     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ âœ… DTOs Created/Enhanced             â”‚
â”‚   â”œâ”€ ChatDto                        â”‚
â”‚   â”œâ”€ ChatInvitationDto              â”‚
â”‚   â”œâ”€ ChatUserDto                    â”‚
â”‚   â””â”€ ChatMessageDto                 â”‚
â”‚                                     â”‚
â”‚ âœ… Services Refactored              â”‚
â”‚   â”œâ”€ ChatService                    â”‚
â”‚   â”œâ”€ InvitationsService             â”‚
â”‚   â”œâ”€ MessagesService                â”‚
â”‚   â””â”€ ChatUserService (verified)     â”‚
â”‚                                     â”‚
â”‚ âœ… Hubs Implemented                 â”‚
â”‚   â”œâ”€ ChatHub (100% complete)        â”‚
â”‚   â”œâ”€ InvitationHub (template)       â”‚
â”‚   â””â”€ MessageHub (template)          â”‚
â”‚                                     â”‚
â”‚ âœ… Components Refactored            â”‚
â”‚   â”œâ”€ ChatCreateForm (DTO-only)      â”‚
â”‚   â”œâ”€ ChatForm (simplified)          â”‚
â”‚   â””â”€ ChatHome (verified)            â”‚
â”‚                                     â”‚
â”‚ âœ… Build Status                     â”‚
â”‚   â””â”€ 0 Errors, 2 Warnings (OK)      â”‚
â”‚                                     â”‚
â”‚ âœ… Documentation Generated          â”‚
â”‚   â”œâ”€ Architecture Summary           â”‚
â”‚   â”œâ”€ Quick Reference                â”‚
â”‚   â”œâ”€ Changes Checklist              â”‚
â”‚   â””â”€ This Diagram File              â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*Generated: 2024-11-11*
*Architecture Version: 1.0 (Clean/Unified)*
